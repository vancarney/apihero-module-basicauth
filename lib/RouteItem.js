// Generated by CoffeeScript 1.9.0
var RouteItem, apihero, fs, _;

fs = require('fs');

_ = require('lodash')._;

apihero = require('api-hero');

RouteItem = (function() {
  function RouteItem(_at_route_item) {
    this.route_item = _at_route_item;
  }

  RouteItem.prototype.save = function(callback) {
    return fs.write(this.route_item.route_path, this.template(this.route_item), (function(_this) {
      return function(e) {
        return typeof callback === "function" ? callback((e != null)) : void 0;
      };
    })(this));
  };

  return RouteItem;

})();

RouteItem.__template__ = "/**\n * <%= name %>.js\n * Route Handler File\n */\nvar _app_ref;\nvar render = function(res, model) {\n res.render( module.exports.templatePath ); \n};\n\nvar <%= name %>Handler = function(req, res, next) {\n  var funcName = module.exports.queryMethod || 'find';\n  var collectionName = ((name = module.exports.collectionName) == \"\") ? null : name;\n  \n  if (collectionName == null) {\n    render(res, {});\n  }\n  \n  _app_ref.models[collectionName][funcName]( module.exports.query, function(e,record) {\n    if (e != null) {\n      console.log(e);\n      return res.sendStatus(500);\n    }\n    \n    render(res,record);\n  });\n};\n\nmodule.exports.init = function(app) {\n  _app_ref = app;\n  app.get(\"<%= route %>\", <%= name %>Handler);\n};\n\nmodule.exports.collectionName = \"<%= route %>\";\nmodule.exports.queryMethod = \"<%= query_method %>\";\nmodule.exports.templatePath = \"<%= template_file %>\";\nmodule.exports.query = {};";

RouteItem.prototype.template = _.template(RouteItem.__template__);
